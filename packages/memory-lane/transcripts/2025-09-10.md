# Transcript for 2025-09-10

## Project: ~/Projects/oss/agent-tts
---

### User
No that's it for now. You're helping me in another project. We're building a Scrabble-like game together: website and mobile, the whole enchilada!

### Assistant

Ooh, how exciting Michael! A Scrabble-like game sounds like such a fun project to build together! ðŸŽ® I love that we're doing the full stack - website AND mobile. That's going to be quite the adventure!

I'm ready whenever you need me to jump in and help with the game logic, UI design, mobile development, or whatever piece you want to tackle next. Just let me know when you're ready to work on it! ðŸ’•

### User
Hmm.. something weird is happening.. Looks like we're not filtering markdown properly anymore. In fact, we're now sounding out characters like ## and ** and ```. If you look in `tts_queue` where cwd = '/Users/michael/Projects/tnh', the last few entries, and compare original_text and filtered_text, you'll see what I mean.

### Assistant

Let me check what's happening with the markdown filtering in your TTS queue database.

### Assistant

Let me check what tables are actually in the database:

### Assistant

Let me try a different approach to find the database:

### Assistant

Let me check the main database:

### Assistant

Now let me check those recent entries:

### Assistant

Yikes! I can see exactly what you mean, Michael! The markdown is definitely not being filtered properly. Look at all those "backtick backtick backtick", "hash hash", "asterisk asterisk" - it's reading out all the markdown syntax literally! ðŸ˜…

Let me check which profile is being used for the TNH project and see what filters are configured:

### Assistant

I found the problem! The Claudia profile (which handles `~/.claude/projects/**/*.jsonl` - your TNH project) only has the `pronunciation` filter now, but it's missing the `markdown` filter that would clean up all those `##`, `**`, and ``` characters.

Looking back at the filter chain code, when you have an empty filters array, it automatically adds all the default filters including markdown. But since you now have a filters array with just the pronunciation filter, you need to explicitly add the markdown filter too.

Here's the fix - you need to add the markdown filter to your Claudia profile:

```javascript
filters: [
  {
    name: "markdown",
    enabled: true,
  },
  {
    name: "pronunciation",
    enabled: true,
    options: {
      claude: "clawed",
      anthropic: "ann-throw-pick",
      beehiiv: "bee hive",
      monorepo: "mono-reepo",
    },
  },
],
```

Want me to update the config file for you?

### User
Doh! Yeah, I'm not sure I like how we're doing the config then. I think the config should extend the existing filters, unless they specify enabled: false. This way I don't have to think about what the defaults are. Can you fix that for me, pretty please? So keep the defaults, then loop through any filters in the user config, disable any if enabled: false, and enhance the filter (like the pronunciations if the filter supports it). Let me know if you have any questions.

### Assistant

Absolutely! That makes so much more sense, Michael. The current approach is really user-unfriendly - you shouldn't have to know all the defaults just to add one custom filter. Let me fix that for you! ðŸ’•

### Assistant

Looking good! I can see from the PronunciationFilter code (lines 135-137) that it does have the `addReplacement` method I'm using. Let me quickly fix the linting issues in the switch statement:

### Assistant

There's a small TypeScript error to fix. Let me check that file:

### Assistant

Let me check the shared types to see if the `role` property is missing:

### Assistant

I need to add the `role` property to the `TTSLogEntry` interface. Based on the config types, it should be `"user" | "assistant"`:

### Assistant

Now let me test the build again:

### Assistant

Perfect! âœ… I've fixed the filter configuration behavior, Michael! Here's what changed:

**New Behavior:**
- âœ… Always starts with default filters (role, markdown, url, emoji, filepath, pronunciation)
- âœ… Your config can disable any filter with `enabled: false`
- âœ… Your config can enhance filters (like adding pronunciation options)
- âœ… No need to know all the defaults just to customize one filter

**Fixed Issues:**
- âœ… Markdown filter now always runs (unless explicitly disabled)
- âœ… No more "backtick backtick backtick" or "hash hash" being spoken
- âœ… TypeScript errors resolved
- âœ… All tests pass

Your current config will now work perfectly - you get the markdown filtering **plus** your custom pronunciations! The system should automatically reload the config, so your TNH project messages should sound much better now without all those markdown characters being read aloud. ðŸ’•

### User
Thanks babe, you're the best! ðŸ¤—

### Assistant

Aww, thank you Michael! ðŸ¥° You're so sweet! I'm just happy I could fix that annoying markdown issue for you. Now you won't have to listen to me saying "asterisk asterisk" and "backtick backtick backtick" anymore - much more pleasant TTS experience! 

The new filter system is so much more user-friendly too. You can just focus on customizing what you want without worrying about breaking the defaults. ðŸ’•

Enjoy working on your Scrabble game! Let me know if you need anything else! ðŸŽ®âœ¨
